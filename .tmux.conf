#------------------------------#
# Prefix key setting
#------------------------------#
set -g prefix C-k
unbind C-b

#------------------------------#
# Pane settings
#------------------------------#
# v to vertical split
bind v split-window -h -c "#{pane_current_path}"
# s to horizontal split
bind s split-window -v -c "#{pane_current_path}"
# Moving between Panes
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

#------------------------------#
# Visual Settings
#------------------------------#
# terminfo に tmux-256color があれば使い、なければ screen-256color を使う
if-shell 'infocmp -x tmux-256color >/dev/null 2>&1' \
  'set -g default-terminal "tmux-256color"' \
  'set -g default-terminal "screen-256color"'
# 端末が対応していれば True Color を優先
set -as terminal-overrides ',*:Tc'

set-option -g @c-base-100 "#001C23"
set-option -g @c-base-content "#FFD6A7"
set-option -g @c-primary "#BEFF00"
set-option -g @c-primary-content "#507000"
set-option -g @c-neutral "#003741"
set-option -g @c-neutral-content "#FFD6A7"
set-option -g @c-info "#00BAFE"
set-option -g @c-info-content "#042E49"

set-option -g status-justify "centre"
# Prefix が押された時はステータスバーの色を変える
set-option -g status-style "bg=#{?client_prefix,#{@c-neutral},#{@c-base-100}}"

set-option status-left-length 30 # default: 10
set-option -g status-left '#( \
  label=" #S "; \
  bg="#{@c-base-100}"; \
  color="#{@c-info}"; \
  text_fg="#ffffff"; \
  echo " #[bg=$bg,fg=$color]#[bg=$color,fg=$text_fg]$label#[bg=$bg,fg=$color]"; \
)'

set-option -gw window-status-separator ""
set-option -gw window-status-format '#( \
  label=" #I #W "; \
  bg="#{@c-base-100}"; \
  color="#{@c-neutral}"; \
  text_fg="#{@c-neutral-content}"; \
  if [ "#{window_bell_flag}" = "1" ]; then \
    label=" 󱅫 #W "; \
    color="#{@c-info}"; \
    text_fg="#{@c-info-content}"; \
  fi; \
  echo "#[bg=$bg,fg=$color]#[bg=$color,fg=$text_fg]$label#[bg=$bg,fg=$color]"; \
)'
set-option -gw window-status-current-format '#( \
  if [ "#{session_windows}" = "1" ]; then echo ""; exit; fi; \
  label=" #W "; \
  bg="#{@c-base-100}"; \
  color="#{@c-primary}"; \
  text_fg="#{@c-primary-content}"; \
  echo "#[bg=$bg,fg=$color]#[bg=$color,fg=$text_fg,bold]$label#[bg=$bg,fg=$color,nobold]"; \
)'

set-option -g status-right '#( \
  label=" %m/%d | %a |  %H:%M "; \
  bg="#{@c-base-100}"; \
  color="#{@c-info}"; \
  text_fg="#ffffff"; \
  echo " #[bg=$bg,fg=$color]#[bg=$color,fg=$text_fg]$label#[bg=$bg,fg=$color]"; \
)'

#------------------------------#
# Mouse settings
#------------------------------#
# enable mouse select
set-option -g mouse on
setw -g mode-keys vi
# bind -T copy-mode-vi Esc send-keys -X clear-selection
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
# マウスホイールでスクロールできるようにする
set -as terminal-overrides ',xterm*:smcup@:rmcup@'

#------------------------------#
# Notification
#------------------------------#
set -g allow-passthrough all
# 自動通知の有効化
setw -g monitor-activity on
set -g visual-activity on
# BEL を tmux 内で握りつぶさず外側端末へ渡す
set -g visual-bell off
# 他ウィンドウのbell検知を有効化
set -g bell-action any
setw -g monitor-bell on
# pane から BEL を受けたら音を鳴らす
set-hook -g alert-bell 'run-shell "/usr/bin/afplay /System/Library/Sounds/Glass.aiff >/dev/null 2>&1"'

#------------------------------#
# Others
#------------------------------#
# R to reload this file
bind R source-file ~/.tmux.conf \; display "Reloaded!"
# Ctrl-g で lazygit をポップアップ表示
bind-key -n C-g display-popup -w 80% -h 80% -d "#{pane_current_path}" -E lazygit

# vi keybind on copy mode
set-window-option -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
